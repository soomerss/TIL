# 데이터 인프라

## 데이터 웨어하우스
 데이터 웨어하우스란 데이터 분석용 테이터베이스를 말한다. 이는 외부의 데이터를 끌어와 구축하며, 통상 프로덕션 데이터베이스를 복사한다. 만약 데이터웨어하우스를 구축하지 않고, 데이터 분석을 시작한다면, 쿼리실행시 프로덕션 데이터베이스에 과부하를 줄 수 있고, 심지어 사고를 발생시킬 수 있어 바람직하지 않다.

 ### 데이터 웨어하우스와 프로덕션 데이터베이스
 데이터 웨어하우스의 종류에는 AWS의 Redshift, Google의 Big Query, SnowFlask, Hive 등이 있다.
 프로덕션 데이터베이스는 Mysql, Oracle 등이 있다. 이 둘은 성능적으로 지향하는 바가 다른데, 전자의 경우 대용량 데이터의 처리를 그 목적으로 두고, 프로덕션 데이터 베이스는 빠른 처리속도를 그 목적에 둔다. 

 데이터웨어하우스는 Denormailized 스키마를 지향하고, 프로덕션 데이터베이스는 스타스키마를 지향한다. 전자는 모든 정보가 합쳐진 테이블을 뜻한다. 후자는 정규화된 테이블을 뜻한다. 즉, 전자는 모든 정보가 합쳐지게 되어 데이터의 업데이트에 불리한 반면 조회시 간편하다. 데이터웨어하우스는 프로덕션 데이터베이스와 달리 실시간으로 업데이트를 처리하기 보다는 분석용 데이터 셋을 구축하는 것이 목적이기 때문에 조회가 한번에 되는 것이 유리하다.

 ## SQL
 SQL은 1970년대 IBM에서 개발한 언어이며, 빅데이터의 도래와 함께 사장될 것이라 예측했지만 여전히 사용하고 있는 언어이다. 이에는 데이터 정의어(DDL), 데이터조작어(DML) 등이 있다. 

 ## 데이터 인프라란 무엇인가
 데이터 인프라란 ETL과 데이터웨어하우스의 구축환경을 뜻한다. ETL이란 Extract, Transform, Load의 약자로 직접 또는 써드로 생기는 데이터를 추출하여, 원하는 형태로 변경한 후, Big Query등의 데이터로 옮기는 작업을 말하며, 이는 Code라고 할 수 있다. 그리고 시간이 지나면서 비구조화된 데이터의 처리가 필요하게 되는데, 이때 Spark 등의 환경을 사용할 수 있다.

 ## Cloud
 Aws, Google 모두 클라우드를 기반으로 하고 있다. 클라우드란 네트워크를 통해서 컴퓨팅자원을 할당 받아 사용하는 환경을 말한다. 종래의 컴퓨팅자원을 할당받기 위해서는 개인용 컴퓨터처럼 물리적 컴퓨터를 구매하여 사용하는 것과는 다르게 네트워크를 통해서 CPU,memory 등을 사용할 수 있다. 물론 Cloud업체는 물리적 컴퓨터가 당연히 있다. 결국 컴퓨터이다. 돈을 받고 이용할 수 있는 실시간 서버 제공소라고 이해해봐도 비슷할 것 같다.

 ## 선두주자 AWS
 AWS는 클라우드 시장에서 아직까지는 1/3의 점유율을 보이며, 선두를 지킨다. 해당 업체는 EC2-(컴퓨팅자원할당), S3(simple stroage sevice), sagemaker(알고리즘 선택 및 하이퍼파라미터 조정), connect(콜센터), lambda(EC2의 업그레이드, 조금 더 서비스에 집중할 수 있도록) 등의 서비스를 제공하며, 이 중에서 우리는 RedShift라고 하는 데이터 웨어하우스 서비스를 이용한다.

 ## RedShift
 2PB 지원하지만 몇 TB에서 문제 발생하니 실제로 저정도까지는 아니다라는 의문이 제기됨. 응답속도 느리니 이것을 프로덕션 데이터베이스로 사용하면 안됨 . 열지향(열의 추가 제거가 용이), 보통은 레코드 지향 데이터베이스이다.
 Bulkupdate를 지원하는데 Insert Into를 통한 복사는 한계가 있다고 한다. 특정 레코드가 초과하면 작업을 반복해서 하여야 하는데, 해당 데이터베이스 전체를 Json 등의 파일로 한번에 복사할 수 있도록 지원한다. 100만건은 1분정도?걸린다고 한다. PostgreSql과 비슷하지만 모두 지원하는 것은 아니다. 텍스트 타입은 아니다.
 이를 통해 폴더=데이터베이스(excel파일 하나)라는 개념을 raw-data, analytics, ad-hoc(테스트) 등으로 구축하는 작업을 한다. 또한 Primary 를 보장하지 않는데, 이는 프로덕션 데이터를 생성하는 측에서 보장해주어야 한다.
